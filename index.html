<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<meta charset="UTF-8" />
<title>üé¨ My Movie Tier List</title>
<meta name="description" content="Create your personal movie tier list! Type a name, drag to rank, save as image ‚Äî simple, beautiful, free.">
<meta name="keywords" content="movie tier list, rate movies, film ranking, SSS tier, movies, tv series">
<meta name="author" content="TaL.S">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Your Custom Favicon -->
<link rel="icon" type="image/png" href="https://tal341.github.io/TaL-Tier-List-Maker./favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://tal341.github.io/TaL-Tier-List-Maker./favicon.svg" />
<link rel="shortcut icon" href="https://tal341.github.io/TaL-Tier-List-Maker./favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://tal341.github.io/TaL-Tier-List-Maker./apple-touch-icon.png" />
<link rel="manifest" href="https://tal341.github.io/TaL-Tier-List-Maker./site.webmanifest" />
<style>
body {
  margin: 0;
  background: #0a0a0a;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
header {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 25px 10px;
  background: rgba(10,10,10,0.9);
  backdrop-filter: blur(4px);
  position: relative;
}
h1 {
  margin: 0;
  font-size: 2.3rem;
  letter-spacing: 1.5px;
  text-shadow: 0 0 10px rgba(255,255,255,0.2);
}

/* Made by TaL.S */
.made-by {
  position: absolute;
  top: 15px;
  right: 65px;
  font-size: 14px;
  opacity: 0.7;
  letter-spacing: 0.5px;
  background: rgba(30,30,30,0.6);
  padding: 4px 12px;
  border-radius: 20px;
  backdrop-filter: blur(2px);
  z-index: 10;
}
.made-by strong {
  color: #ffdd55;
  font-weight: bold;
  text-shadow: 0 0 4px rgba(255,221,85,0.5);
}

/* Settings Button */
.settings-btn {
  position: absolute;
  top: 18px;
  right: 25px;
  font-size: 22px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(40,40,40,0.7);
  border: none;
  border-radius: 50%;
  color: #ffdd55;
  cursor: pointer;
  z-index: 15;
  transition: all 0.2s ease;
  backdrop-filter: blur(3px);
}
.settings-btn:hover {
  transform: scale(1.1);
  background: rgba(60,60,60,0.9);
  box-shadow: 0 0 12px rgba(255,221,85,0.4);
}

/* Modal Overlay */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}
.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}
.modal {
  background: #1a1a1a;
  width: 90%;
  max-width: 500px;
  padding: 30px;
  border-radius: 18px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  position: relative;
  animation: modalPop 0.3s ease-out;
}
@keyframes modalPop {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.modal h2 {
  margin-top: 0;
  color: #ffdd55;
  font-size: 24px;
  text-align: center;
  margin-bottom: 20px;
}
.modal p {
  line-height: 1.6;
  margin-bottom: 15px;
  font-size: 15px;
}
.close-modal {
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 24px;
  background: none;
  border: none;
  color: #aaa;
  cursor: pointer;
  transition: color 0.2s;
}
.close-modal:hover {
  color: #ffdd55;
}
.modal-credit {
  margin-top: 25px;
  padding-top: 20px;
  border-top: 1px solid #333;
  font-size: 14px;
  text-align: center;
  color: #aaa;
}
.modal-credit strong {
  color: #ffdd55;
}
.edit-tier-section {
  margin-top: 30px;
}
.edit-tier-section h3 {
  color: #ffdd55;
  margin-bottom: 15px;
  font-size: 18px;
}
.tier-edit-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  padding: 8px;
  background: rgba(40,40,40,0.5);
  border-radius: 8px;
}
.tier-edit-row input {
  flex: 1;
  padding: 8px 12px;
  background: #2a2a2a;
  border: 1px solid #444;
  color: white;
  border-radius: 6px;
  font-size: 15px;
}
.tier-edit-row .label-preview {
  font-weight: bold;
  min-width: 60px;
  text-align: center;
  padding: 4px 8px;
  border-radius: 6px;
  background: rgba(255,221,85,0.15);
  color: #ffdd55;
}
.tier-list {
  display: flex;
  flex-direction: column;
  gap: 24px;
  padding: 30px 20px;
}
.tier {
  min-height: 120px;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: 16px;
  backdrop-filter: blur(3px);
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
  transition: transform 0.2s ease;
  position: relative;
  overflow: hidden;
}
.tier:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}
.tier-label-container {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  gap: 5px;
  min-width: 110px;
  z-index: 2;
}
.tier-label-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
}
.tier-icon {
  font-size: 20px;
  opacity: 0.8;
}
.tier-label {
  font-weight: 900;
  font-size: 28px;
  color: #fff;
  text-shadow: 0 0 8px rgba(0,0,0,0.8);
  letter-spacing: 1px;
  line-height: 1.1;
}
.tier-subtitle {
  font-size: 12px;
  font-weight: 600;
  opacity: 0.7;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}
.tier.SSS { background: linear-gradient(135deg, rgba(255,30,30,0.15), transparent); border: 2px solid rgba(255,215,0,0.3); }
.tier.SS  { background: linear-gradient(135deg, rgba(255,140,0,0.1), transparent); border: 2px solid rgba(255,180,0,0.2); }
.tier.S   { background: linear-gradient(135deg, rgba(255,220,0,0.08), transparent); border: 2px solid rgba(255,220,0,0.2); }
.tier.Ap  { background: linear-gradient(135deg, rgba(100,255,100,0.07), transparent); border: 2px solid rgba(100,255,100,0.2); }
.tier.B   { background: linear-gradient(135deg, rgba(150,200,255,0.06), transparent); border: 2px solid rgba(150,200,255,0.2); }
.tier.C   { background: linear-gradient(135deg, rgba(180,80,180,0.1), transparent); border: 2px solid rgba(200,50,50,0.3); position: relative; }
.tier.C::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 40%; background: rgba(200,50,50,0.1); z-index: 1; pointer-events: none; }

.poster {
  width: 100px;
  height: auto;
  margin: 0;
  cursor: grab;
  border-radius: 8px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  transition: transform 0.2s ease;
  z-index: 2;
  position: relative;
}
.poster:hover {
  transform: scale(1.03);
  box-shadow: 0 5px 14px rgba(0,0,0,0.5);
}

.delete-btn {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: #ff3333;
  color: white;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  border: 1px solid white;
  opacity: 0;
  transform: scale(0.7);
  transition: all 0.2s ease;
}
.poster:hover .delete-btn {
  opacity: 1;
  transform: scale(1);
}
@media (max-width: 768px) {
  .delete-btn {
    opacity: 1;
    transform: scale(1);
  }
  .tier-label { font-size: 26px; }
  .tier-subtitle { font-size: 12px; }
  .modal { padding: 30px 20px; margin: 20px; }
  .modal h2 { font-size: 24px; }
  .modal p { font-size: 16px; }
}

#unranked-area {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px 15px;
  gap: 18px;
  border-top: 2px solid rgba(80,80,80,0.5);
  background: rgba(20,20,20,0.6);
  border-radius: 12px;
  margin-top: 20px;
  backdrop-filter: blur(5px);
}
#unranked-label {
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  padding: 15px;
  color: #cccccc;
  text-shadow: 0 0 6px rgba(0,0,0,0.8);
  width: 100%;
  background: rgba(30,30,30,0.7);
  border-radius: 10px;
  backdrop-filter: blur(3px);
}
#movieInput {
  display: block;
  margin: 25px auto;
  padding: 16px 20px;
  width: 80%;
  max-width: 420px;
  background: rgba(30,30,30,0.8);
  color: white;
  border: 2px solid rgba(100,100,100,0.5);
  border-radius: 12px;
  font-size: 16px;
  text-align: center;
  outline: none;
  backdrop-filter: blur(3px);
  transition: all 0.2s;
}
#movieInput:focus {
  border-color: rgba(200,200,200,0.8);
  background: rgba(40,40,40,0.9);
  transform: translateY(-2px);
}

input[type="file"],
.download-btn,
.reset-btn,
#saveListBtn,
#loadHistoryBtn,
#shareBtn {
  display: block;
  margin: 18px auto;
  padding: 14px 26px;
  background: rgba(40,40,40,0.8);
  color: white;
  border: 2px solid rgba(100,100,100,0.5);
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  letter-spacing: 0.8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  backdrop-filter: blur(3px);
  transition: all 0.2s ease;
}
.download-btn { background: rgba(60,60,80,0.7); border-color: rgba(100,100,150,0.4); }
.download-btn:hover { background: rgba(70,70,100,0.9); }
.reset-btn { background: rgba(80,40,40,0.7); border-color: rgba(150,80,80,0.4); }
.reset-btn:hover { background: rgba(100,50,50,0.9); }
#saveListBtn { background: rgba(40,60,40,0.7); border-color: rgba(80,120,80,0.4); }
#saveListBtn:hover { background: rgba(50,70,50,0.9); }
#loadHistoryBtn { background: rgba(50,50,70,0.7); border-color: rgba(100,100,150,0.4); }
#loadHistoryBtn:hover { background: rgba(60,60,90,0.9); }
#shareBtn { background: rgba(60,40,80,0.7); border-color: rgba(120,80,160,0.4); }
#shareBtn:hover { background: rgba(70,50,90,0.9); }

/* Mobile Tier Selector Popup */
.mobile-tier-popup {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  z-index: 2000;
  display: none;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  max-width: 92%;
}
.mobile-tier-btn {
  padding: 12px 16px;
  background: rgba(50,50,50,0.8);
  border: 1px solid #444;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
  font-size: 16px;
}
.mobile-tier-btn:hover {
  background: #ffdd55;
  color: #000;
}
.mobile-tier-btn.SSS { background: rgba(255,30,30,0.2); }
.mobile-tier-btn.SS  { background: rgba(255,140,0,0.2); }
.mobile-tier-btn.S   { background: rgba(255,220,0,0.2); }
.mobile-tier-btn.Ap  { background: rgba(100,255,100,0.2); }
.mobile-tier-btn.B   { background: rgba(150,200,255,0.2); }
.mobile-tier-btn.C   { background: rgba(200,50,50,0.2); }

/* History Modal */
#historyList div {
  padding: 14px;
  margin: 10px 0;
  background: #333;
  border-radius: 10px;
  cursor: pointer;
  text-align: center;
  font-size: 16px;
}
#historyList div:hover {
  background: #ffdd55;
  color: #000;
}

/* Search Results Modal with posters */
#searchResultsList {
  max-height: 420px;
  overflow-y: auto;
}
.search-result-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px;
  margin: 10px 0;
  background: #333;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s;
}
.search-result-item:hover {
  background: #ffdd55;
  color: #000;
}
.search-poster {
  width: 65px;
  height: 95px;
  border-radius: 8px;
  object-fit: cover;
  background: #222;
  border: 1px solid #444;
}
.search-info {
  flex: 1;
}
.search-title {
  font-weight: bold;
  margin: 0 0 6px 0;
  font-size: 16px;
}
.search-year-type {
  font-size: 14px;
  opacity: 0.85;
}
.show-more-btn {
  display: block;
  margin: 20px auto 0;
  padding: 10px 20px;
  background: rgba(60,60,80,0.6);
  color: white;
  border: 1px solid rgba(100,100,150,0.4);
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
}
.show-more-btn:hover {
  background: rgba(70,70,100,0.8);
}
</style>
</head>
<body>
<header>
  <h1>üé¨ My Movie Tier List</h1>
  <span class="made-by">Made by <strong>TaL.S</strong></span>
  <button class="settings-btn" id="settingsBtn">‚ìò</button>
</header>

<div class="tier-list">
  <div class="tier SSS" data-tier="SSS"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">üèÜ</span><div class="tier-label">SSS</div></div><div class="tier-subtitle">TOP!</div></div></div>
  <div class="tier SS" data-tier="SS"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">‚≠ê</span><div class="tier-label">SS</div></div><div class="tier-subtitle">Excellent</div></div></div>
  <div class="tier S" data-tier="S"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">üëç</span><div class="tier-label">S</div></div><div class="tier-subtitle">Great</div></div></div>
  <div class="tier Ap" data-tier="A+"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">‚úÖ</span><div class="tier-label">A+</div></div><div class="tier-subtitle">Good</div></div></div>
  <div class="tier B" data-tier="B"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">üòê</span><div class="tier-label">B</div></div><div class="tier-subtitle">Okay</div></div></div>
  <div class="tier C" data-tier="C"><div class="tier-label-container"><div class="tier-label-wrapper"><span class="tier-icon">üóëÔ∏è</span><div class="tier-label">C</div></div><div class="tier-subtitle">Trash Zone</div></div></div>
</div>

<div id="unranked-label">üé¨ Movies & Series</div>
<div id="unranked-area"></div>

<input type="text" id="movieInput" placeholder="üé¨ Enter movie or series name and press Enter">
<input type="file" id="fileInput" multiple accept="image/*">
<button id="downloadBtn" class="download-btn">üíæ Save as Image</button>
<button id="resetBtn" class="reset-btn">üîÑ Reset All</button>
<button id="saveListBtn" class="download-btn">üíæ Save List</button>
<button id="loadHistoryBtn" class="download-btn">üìö Load History</button>
<button id="shareBtn" class="download-btn">üì§ Share List</button>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <button class="close-modal" id="closeSettings">&times;</button>
    <h2>üõ† Settings & Help</h2>
    <p><strong>How to use:</strong><br>
       Type a movie or series name in the input above and press Enter.<br>
       The poster that appears can be dragged directly to any Tier using your mouse.<br>
       On mobile ‚Äî tap the poster to open a menu and choose a Tier easily.</p>
    <p><strong>Saving:</strong><br>
       Click "Save as Image" to download your tier list as a PNG file.<br>
       Or use "Save List" to store your ranking on this device and start a new one.</p>
    <div class="edit-tier-section">
      <h3>‚úèÔ∏è Rename Tiers (for you only)</h3>
      <div class="tier-edit-row">
        <span class="label-preview">SSS</span>
        <input type="text" class="tier-input" data-target="SSS" placeholder="New name for SSS" value="SSS">
      </div>
      <div class="tier-edit-row">
        <span class="label-preview">SS</span>
        <input type="text" class="tier-input" data-target="SS" placeholder="New name for SS" value="SS">
      </div>
      <div class="tier-edit-row">
        <span class="label-preview">S</span>
        <input type="text" class="tier-input" data-target="S" placeholder="New name for S" value="S">
      </div>
      <div class="tier-edit-row">
        <span class="label-preview">A+</span>
        <input type="text" class="tier-input" data-target="A+" placeholder="New name for A+" value="A+">
      </div>
      <div class="tier-edit-row">
        <span class="label-preview">B</span>
        <input type="text" class="tier-input" data-target="B" placeholder="New name for B" value="B">
      </div>
      <div class="tier-edit-row">
        <span class="label-preview">C</span>
        <input type="text" class="tier-input" data-target="C" placeholder="New name for C" value="C">
      </div>
    </div>
    <div class="modal-credit">
      Created with ‚ù§Ô∏è by <strong>TaL.S</strong><br>
      Thank you for using the site!
    </div>
  </div>
</div>

<!-- Mobile Tier Selector -->
<div class="mobile-tier-popup" id="mobileTierPopup">
  <div class="mobile-tier-btn SSS" data-tier="SSS">SSS</div>
  <div class="mobile-tier-btn SS" data-tier="SS">SS</div>
  <div class="mobile-tier-btn S" data-tier="S">S</div>
  <div class="mobile-tier-btn Ap" data-tier="A+">A+</div>
  <div class="mobile-tier-btn B" data-tier="B">B</div>
  <div class="mobile-tier-btn C" data-tier="C">C</div>
  <div class="mobile-tier-btn" id="cancelMobileSelect" style="background:#555;">Cancel</div>
</div>

<!-- History Modal -->
<div class="modal-overlay" id="historyModal">
  <div class="modal" style="max-width: 400px;">
    <button class="close-modal" id="closeHistory">&times;</button>
    <h2>üìö Load Saved List</h2>
    <div id="historyList" style="max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
  </div>
</div>

<!-- Search Results Modal (Multi-Search with posters + Show More) -->
<div class="modal-overlay" id="searchResultsModal">
  <div class="modal" style="max-width: 520px;">
    <button class="close-modal" id="closeSearchResults">&times;</button>
    <h2>üé¨ Choose a movie</h2>
    <div id="searchResultsList" style="max-height: 420px; overflow-y: auto; margin-top: 20px;"></div>
    <button id="showMoreBtn" class="show-more-btn" style="display: none;">Show More Results</button>
    <div style="margin-top: 20px; text-align: center; font-size: 14px; color: #aaa;">
      Not what you wanted? Try a more specific title.
    </div>
  </div>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const movieInput = document.getElementById('movieInput');
const unranked = document.getElementById('unranked-area');
const tiers = document.querySelectorAll('.tier');
const OMDB_API_KEY = "ee77ebb9";

function isMobile() {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

function initMobilePosterClick() {
  if (!isMobile()) return;

  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('poster')) {
      currentSelectedPoster = e.target;
      const popup = document.getElementById('mobileTierPopup');
      popup.style.display = 'flex';
    }
  });

  const popupButtons = document.querySelectorAll('.mobile-tier-btn');
  popupButtons.forEach(btn => {
    if (btn.id === 'cancelMobileSelect') {
      btn.addEventListener('click', () => {
        document.getElementById('mobileTierPopup').style.display = 'none';
      });
    } else {
      btn.addEventListener('click', () => {
        const tierName = btn.dataset.tier;
        const targetTier = document.querySelector(`.tier[data-tier="${tierName}"]`);
        if (currentSelectedPoster && targetTier) {
          targetTier.appendChild(currentSelectedPoster);
          document.getElementById('mobileTierPopup').style.display = 'none';
        }
      });
    }
  });
}

let currentSelectedPoster = null;
let allSearchResults = [];
let displayedResultsCount = 5;

movieInput.addEventListener('keypress', async (e) => {
  if (e.key === 'Enter') {
    const movieName = e.target.value.trim();
    if (!movieName) return;

    try {
      let searchResponse = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(movieName)}&apikey=${OMDB_API_KEY}`);
      let searchData = await searchResponse.json();

      if (searchData.Response === "False") {
        alert("Movie not found üòï\nTry another name or in English.");
        return;
      }

      if (!searchData.Search || searchData.Search.length === 0) {
        alert("No results found. Try a different title.");
        return;
      }

      allSearchResults = searchData.Search;
      displayedResultsCount = 5;

      showSearchResultsWithPosters(allSearchResults.slice(0, displayedResultsCount));

    } catch (error) {
      alert("Something went wrong. Check your internet?");
      console.error(error);
    }
  }
});

async function showSearchResultsWithPosters(results) {
  const modal = document.getElementById('searchResultsModal');
  const list = document.getElementById('searchResultsList');
  const showMoreBtn = document.getElementById('showMoreBtn');
  
  list.innerHTML = '';

  for (const result of results) {
    try {
      const detailResponse = await fetch(`https://www.omdbapi.com/?i=${result.imdbID}&apikey=${OMDB_API_KEY}`);
      const data = await detailResponse.json();

      const item = document.createElement('div');
      item.className = 'search-result-item';
      item.innerHTML = `
        <img class="search-poster" src="${data.Poster && data.Poster !== 'N/A' ? data.Poster : 'https://via.placeholder.com/65x95/333/fff?text=No+Img'}" alt="${data.Title}" onerror="this.src='https://via.placeholder.com/65x95/333/fff?text=No+Img'">
        <div class="search-info">
          <div class="search-title">${data.Title}</div>
          <div class="search-year-type">${data.Year} ‚Ä¢ ${data.Type}</div>
        </div>
      `;

      item.addEventListener('click', () => {
        addMovieToBoard(data);
        modal.classList.remove('active');
      });

      list.appendChild(item);
    } catch (err) {
      console.error("Error fetching movie details:", err);
    }
  }

  if (displayedResultsCount < allSearchResults.length) {
    showMoreBtn.style.display = 'block';
  } else {
    showMoreBtn.style.display = 'none';
  }

  modal.classList.add('active');
}

document.getElementById('showMoreBtn').addEventListener('click', async () => {
  displayedResultsCount += 5;
  const nextBatch = allSearchResults.slice(0, displayedResultsCount);
  showSearchResultsWithPosters(nextBatch);
});

function addMovieToBoard(data) {
  if (!data.Poster || data.Poster === "N/A") {
    alert("No poster available for this movie üñºÔ∏è");
    return;
  }

  const img = document.createElement('img');
  img.src = data.Poster;
  img.alt = data.Title;
  img.title = `${data.Title} (${data.Year}) ‚Ä¢ ${data.Type}`;
  img.classList.add('poster');
  img.draggable = true;
  img.dataset.movieTitle = data.Title;
  img.style.position = 'relative'; // ‚úÖ ◊ó◊©◊ï◊ë - ◊û◊ê◊§◊©◊® ◊ú◊õ◊§◊™◊ï◊® ◊ú◊î◊ï◊§◊ô◊¢

  const deleteBtn = document.createElement('div');
  deleteBtn.innerHTML = '√ó';
  deleteBtn.className = 'delete-btn';
  deleteBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    if (confirm('Delete this movie?')) {
      img.remove();
    }
  });
  img.appendChild(deleteBtn);

  img.addEventListener('dragstart', dragStart);

  if (isMobile()) {
    img.addEventListener('click', function() {
      currentSelectedPoster = this;
      document.getElementById('mobileTierPopup').style.display = 'flex';
    });
  }

  img.onload = () => {
    unranked.appendChild(img);
    movieInput.value = '';
    movieInput.placeholder = "üé¨ Try another one...";
  };

  img.onerror = () => {
    alert("Error loading image. Try again?");
  };
}

fileInput.addEventListener('change', (event) => {
  const files = event.target.files;
  for (const file of files) {
    if (!file.type.startsWith('image/')) continue;
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = document.createElement('img');
      img.src = e.target.result;
      img.classList.add('poster');
      img.draggable = true;
      img.dataset.originalSrc = e.target.result;
      img.style.position = 'relative'; // ‚úÖ ◊ó◊©◊ï◊ë - ◊û◊ê◊§◊©◊® ◊ú◊õ◊§◊™◊ï◊® ◊ú◊î◊ï◊§◊ô◊¢

      const deleteBtn = document.createElement('div');
      deleteBtn.innerHTML = '√ó';
      deleteBtn.className = 'delete-btn';
      deleteBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (confirm('Delete this movie?')) {
          img.remove();
        }
      });
      img.appendChild(deleteBtn);

      img.addEventListener('dragstart', dragStart);

      if (isMobile()) {
        img.addEventListener('click', function() {
          currentSelectedPoster = this;
          document.getElementById('mobileTierPopup').style.display = 'flex';
        });
      }

      unranked.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
});

function dragStart(e) {
  e.dataTransfer.setData('text/plain', e.target.src);
}

tiers.forEach(tier => {
  tier.addEventListener('dragover', (e) => e.preventDefault());
  tier.addEventListener('drop', (e) => {
    e.preventDefault();
    const src = e.dataTransfer.getData('text/plain');
    const img = document.querySelector(`img[src='${src}']`);
    if (img) tier.appendChild(img);
  });
});

unranked.addEventListener('dragover', (e) => e.preventDefault());
unranked.addEventListener('drop', (e) => {
  e.preventDefault();
  const src = e.dataTransfer.getData('text/plain');
  const img = document.querySelector(`img[src='${src}']`);
  if (img) unranked.appendChild(img);
});

document.getElementById('resetBtn').addEventListener('click', () => {
  const allPosters = document.querySelectorAll('.poster');
  allPosters.forEach(poster => unranked.appendChild(poster));
});

document.getElementById('downloadBtn').addEventListener('click', () => {
  const script = document.createElement('script');
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
  script.onload = () => {
    const element = document.querySelector('.tier-list').parentNode;
    html2canvas(element, {
      backgroundColor: '#0a0a0a',
      scale: 2,
      useCORS: true,
      allowTaint: true
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'my-movie-tierlist.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  };
  document.head.appendChild(script);
});

const settingsBtn = document.getElementById('settingsBtn');
const closeSettings = document.getElementById('closeSettings');
const modalOverlay = document.getElementById('settingsModal');
const tierInputs = document.querySelectorAll('.tier-input');

settingsBtn.addEventListener('click', () => {
  modalOverlay.classList.add('active');
});

closeSettings.addEventListener('click', () => {
  modalOverlay.classList.remove('active');
});

modalOverlay.addEventListener('click', (e) => {
  if (e.target === modalOverlay) {
    modalOverlay.classList.remove('active');
  }
});

tierInputs.forEach(input => {
  input.addEventListener('input', function() {
    const targetTier = this.dataset.target;
    const labelElement = document.querySelector(`.tier[data-tier="${targetTier}"] .tier-label`);
    if (labelElement) {
      labelElement.textContent = this.value;
    }
  });
});

let listCounter = 1;

document.getElementById('saveListBtn').addEventListener('click', () => {
  const tiersData = {};
  document.querySelectorAll('.tier').forEach(tier => {
    const tierName = tier.dataset.tier;
    const posters = Array.from(tier.querySelectorAll('.poster')).map(img => ({
      src: img.src,
      alt: img.alt,
      title: img.title
    }));
    tiersData[tierName] = posters;
  });

  const unrankedPosters = Array.from(document.querySelectorAll('#unranked-area .poster')).map(img => ({
    src: img.src,
    alt: img.alt,
    title: img.title
  }));
  tiersData.unranked = unrankedPosters;

  const listName = `List ${listCounter}`;
  localStorage.setItem(listName, JSON.stringify(tiersData));
  alert(`‚úÖ Saved as "${listName}"`);
  listCounter++;
});

const historyModal = document.getElementById('historyModal');

document.getElementById('loadHistoryBtn').addEventListener('click', () => {
  const historyList = document.getElementById('historyList');
  historyList.innerHTML = '';

  let hasLists = false;
  for (let i = 1; i <= 50; i++) {
    const key = `List ${i}`;
    const saved = localStorage.getItem(key);
    if (saved) {
      hasLists = true;
      const btn = document.createElement('div');
      btn.style.padding = '14px';
      btn.style.margin = '10px 0';
      btn.style.background = '#333';
      btn.style.borderRadius = '10px';
      btn.style.cursor = 'pointer';
      btn.style.textAlign = 'center';
      btn.style.fontSize = '16px';
      btn.textContent = key;
      btn.addEventListener('click', () => {
        loadList(key);
        historyModal.classList.remove('active');
      });
      historyList.appendChild(btn);
    }
  }

  if (!hasLists) {
    historyList.innerHTML = '<p style="text-align:center; color:#aaa; font-size:16px;">No saved lists yet.</p>';
  }

  historyModal.classList.add('active');
});

document.getElementById('closeHistory').addEventListener('click', () => {
  historyModal.classList.remove('active');
});

historyModal.addEventListener('click', (e) => {
  if (e.target === historyModal) {
    historyModal.classList.remove('active');
  }
});

function loadList(listName) {
  const savedData = localStorage.getItem(listName);
  if (!savedData) return;

  const tiersData = JSON.parse(savedData);

  document.querySelectorAll('.poster').forEach(p => p.remove());

  for (const tierName in tiersData) {
    if (tierName === 'unranked') continue;
    const tierEl = document.querySelector(`.tier[data-tier="${tierName}"]`);
    if (tierEl && tiersData[tierName]) {
      tiersData[tierName].forEach(item => {
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = item.alt;
        img.title = item.title;
        img.classList.add('poster');
        img.draggable = true;
        img.addEventListener('dragstart', dragStart);
        img.style.position = 'relative'; // ‚úÖ ◊ó◊©◊ï◊ë

        const deleteBtn = document.createElement('div');
        deleteBtn.innerHTML = '√ó';
        deleteBtn.className = 'delete-btn';
        deleteBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          if (confirm('Delete this movie?')) {
            img.remove();
          }
        });
        img.appendChild(deleteBtn);

        if (isMobile()) {
          img.addEventListener('click', function() {
            currentSelectedPoster = this;
            document.getElementById('mobileTierPopup').style.display = 'flex';
          });
        }
        tierEl.appendChild(img);
      });
    }
  }

  const unrankedArea = document.getElementById('unranked-area');
  if (tiersData.unranked) {
    tiersData.unranked.forEach(item => {
      const img = document.createElement('img');
      img.src = item.src;
      img.alt = item.alt;
      img.title = item.title;
      img.classList.add('poster');
      img.draggable = true;
      img.addEventListener('dragstart', dragStart);
      img.style.position = 'relative'; // ‚úÖ ◊ó◊©◊ï◊ë

      const deleteBtn = document.createElement('div');
      deleteBtn.innerHTML = '√ó';
      deleteBtn.className = 'delete-btn';
      deleteBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (confirm('Delete this movie?')) {
          img.remove();
        }
      });
      img.appendChild(deleteBtn);

      if (isMobile()) {
        img.addEventListener('click', function() {
          currentSelectedPoster = this;
          document.getElementById('mobileTierPopup').style.display = 'flex';
        });
      }
      unrankedArea.appendChild(img);
    });
  }

  alert(`üìÇ Loaded "${listName}"`);
}

document.getElementById('shareBtn').addEventListener('click', () => {
  let shareText = "My Movie Tier List:\n\n";
  
  document.querySelectorAll('.tier').forEach(tier => {
    const tierName = tier.dataset.tier;
    const movies = Array.from(tier.querySelectorAll('.poster')).map(img => img.alt || "Unknown Movie");
    if (movies.length > 0) {
      shareText += `${tierName}: ${movies.join(', ')}\n`;
    }
  });

  const unrankedMovies = Array.from(document.querySelectorAll('#unranked-area .poster')).map(img => img.alt || "Unknown Movie");
  if (unrankedMovies.length > 0) {
    shareText += `\nUnranked: ${unrankedMovies.join(', ')}`;
  }

  shareText += "\n\nCreated with ‚ù§Ô∏è by TaL.S";

  if (navigator.share) {
    navigator.share({
      title: 'My Movie Tier List',
      text: shareText
    }).catch(err => {
      fallbackCopyTextToClipboard(shareText);
    });
  } else {
    fallbackCopyTextToClipboard(shareText);
  }
});

function fallbackCopyTextToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert("üìã Copied to clipboard!\nPaste anywhere to share.");
  }).catch(() => {
    prompt("Copy the text below:", text);
  });
}

document.getElementById('closeSearchResults').addEventListener('click', () => {
  document.getElementById('searchResultsModal').classList.remove('active');
});

document.getElementById('searchResultsModal').addEventListener('click', (e) => {
  if (e.target === document.getElementById('searchResultsModal')) {
    document.getElementById('searchResultsModal').classList.remove('active');
  }
});

initMobilePosterClick();
</script>
</body>
</html>
